{% extends "menu.html" %} {% block body %}
<div class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-6">
				<div class="card">
					<div class="content">
						<div class="row">
							<div class="col-sm-12">
								<h5>ID {{ client.id }}</h5>
								<h5>{{ client.client }}</h5>
								<h5>{{ client.phone }}</h5>
								<h5>{{ client.facebook }}</h5>
								<h5>{{ client.observation }}</h5>
								<h5>R$ {{ (client.balance + totalPurchase.total - totalSale.total)|number_format(2, ',', '.') }}</h5>
								<h5>U$ {{ (chipSale.total - chipPurchase.total)|number_format(2, ',', '.') }}</h5>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="card">
					<div class="header">
						<h4 class="title">Sites <a type="button" href="/client-site-new/{{ client.id }}" title="Cadastrar" class="btn btn-social btn-round btn-default btn-fill"><i class="fa fa-plus"></i></a></h4>
					</div>
					<div class="content">
						<div class="table-responsive">
							<table class="table table-striped table-no-bordered table-hover display" cellspacing="0" width="100%" style="width:100%">
								<thead>
									<tr>
										<th>Nome</th>
										<th>Endereço</th>
										<th>Observações</th>
										</th>
										<th>Usuários</th>
									</tr>
								</thead>
								<tbody>
									{% for site in sites %}
									<tr>
										<td>{{ site.site }}</td>
										<td>{{ site.address }}</td>
										<td>{{ site.observation }}</td>
										<td>
											{% for user_client in users_sites %} {% if user_client.site == site.id %} {{ user_client.username }} <br> {% endif
											%} {% endfor %}
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- <div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="header">
						<h4 class="title">Extrato</h4>
					</div>
					<div class="content">
						<div class="table-responsive">
							<table class="table table-striped table-no-bordered table-hover displaynosearch" cellspacing="0" width="100%" style="width:100%">
								<thead>
									<tr>
										<th>Data</th>
										<th>Descrição</th>
										<th>Tipo</th>
										<th>Fichas</th>
										<th>Valor</th>
									</tr>
								</thead>
								<tbody>
									{% for sale in sales %}
									<tr>
										<td>{{ sale.date|date('d/m/Y') }}</td>
										{% if sale.status == 0 %}
											<td>Venda Pendente</td>
											<td><a style="color: red;" href="javascript:window.open('/sale-edit/{{ sale.id }}','Venda {{sale.id}}','width=750,height=750')">Venda {{sale.id}} <i class="fa fa-external-link"></i></a></td>
										{% elseif sale.status == 1 %}
											<td>Venda Finalizada</td>
											<td><a style="color: red;" href="javascript:window.open('/sale-view/{{ sale.id }}','Venda {{sale.id}}','width=750,height=750')">Venda {{sale.id}} <i class="fa fa-external-link"></i></a></td>
										{% else %}
											<td>Venda Devolvida</td>
											<td><a style="color: red;" href="javascript:window.open('/sale-view/{{ sale.id }}','Venda {{sale.id}}','width=750,height=750')">Venda {{sale.id}} <i class="fa fa-external-link"></i></a></td>
										{% endif %}
										<td>{{sale.poker_chip}}</td>
										<td <a style="color: red;" align="right">- R$ {{ sale.total|number_format(2, ',', '.') }}</td>
									</tr>
									{% endfor %}
									{% for purchase in purchases %}
									<tr>
										<td>{{ purchase.date|date('d/m/Y') }}</td>
										{% if purchase.status == 0 %}
											<td>Compra Pendente</td>
											<td><a style="color: green;" href="javascript:window.open('/purchase-edit/{{ purchase.id }}','Compra {{purchase.id}}','width=750,height=750')">Compra {{purchase.id}} <i class="fa fa-external-link"></i></a></td>
										{% else %}
											<td>Compra Finalizada</td>
											<td><a style="color: green;" href="javascript:window.open('/purchase-view/{{ purchase.id }}','Compra {{purchase.id}}','width=750,height=750')">Compra {{purchase.id}} <i class="fa fa-external-link"></i></a></td>
										{% endif %}
										<td>{{purchase.poker_chip}}</td>
										<td style="color: green;" align="right">R$ {{ purchase.total|number_format(2, ',', '.') }}</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div> -->
		<div class="row">
			<div class="col-sm-6">
				<div class="card">
					<div class="header">
						<h4 class="title">Envio e Recebimento de Fichas <a type="button" href="#" title="Cadastrar" onclick="newChipFlow();" class="btn btn-social btn-round btn-default btn-fill"><i class="fa fa-plus"></i></a></h4>
					</div>
					<div class="content">
						<div class="row">

						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="card">
					<div class="content">
						<div class="row">

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	function newChipFlow()
	{
		listClientSite('{{client.id}}');
		var html = '<form method="POST" action="/chip-flow-new"> <div class="row"> <div class="col-md-12 form-group"> <label>Operação</label> <select class="form-control" name="operation" required="true"> <option value="-">Enviar</option> <option value="+">Receber</option> </select> </div> </div> <div class="row"> <div class="col-md-12 form-group"> <label>Sites do Cliente</label> <select class="form-control" name="site_id" id="site_id" onchange="listClientSiteUser();" required="true"> </select> </div> <div class="col-md-12 form-group"> <label>Nicks do Site</label> <select class="form-control" name="client_site_user_id" id="client_site_user_id" required="true"> </select> </div> </div> <div class="row"> <div class="col-md-12 form-group"> <label>Conveniados para o Site</label> <select class="form-control" name="agreed_id" id="agreed_id" required="true"> </select> </div> <div class="col-md-12 form-group"> <label>Fichas</label> <input type="number" name="total" class="form-control" required="true"> </div> </div> <br> <div class="row"> <div class="col-sm-12"> <div class="pull-right"> <button type="submit" class="btn btn-fill btn-success"> Salvar</button> </div> </div> </div> </form>';
		
		swal({  title: "Enviar/Receber Fichas",
			html: html,
			showCancelButton: false, 
			showConfirmButton: false

		});
	}

	function listClientSite(id) {
		$.ajax({
			type: "GET",
			url: "/client-site-list-json/" + id,
			success: function(data) {
				data = JSON.parse(data);
				var sites = $('#site_id');
				sites.empty();
				$(data).each(function () {
					sites.append(
						$('<option />', {
							value: this.id
						}).html(this.site)
					);
				});
				listClientSiteUser();
				listAgreed();
			}
		});
	}

	function listClientSiteUser() {
		var id = '{{client.id}}';
		var site = $( "select#site_id option:selected" ).val();
		$.ajax({
			type: "GET",
			url: "/client-site-user-list-json/" + id + '/' + site,
			success: function(data) {
				data = JSON.parse(data);
				var users_site = $('#client_site_user_id');
				users_site.empty();
				$(data).each(function () {
					users_site.append(
						$('<option />', {
							value: this.id
						}).html(this.username)
					);
				});
				listAgreed();
			}
		});
	}

	function listAgreed() {
		var id = $( "select#site_id option:selected" ).val();
		$.ajax({
			type: "GET",
			url: "/agreed-site-list-json/" + id,
			success: function(data) {
				data = JSON.parse(data);
				var agreeds = $('#agreed_id');
				agreeds.empty();
				$(data).each(function () {
					agreeds.append(
						$('<option />', {
							value: this.id
						}).html(this.agreed)
					);
				});
			}
		});
	}
</script>
{% endblock %}